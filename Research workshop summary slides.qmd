---
title: "Research workshop summary slides"
format: pptx
editor: visual
---

# DATA SCIENCE WORKSHOP

## SDG 6.2 Reproducibility

## Outline

Overall vision (raw data, estimates code, jmp estimates package)

Raw data package documentation (proof-of-concept website)

-   Statistics of the raw data

Master Thesis Project

-   Input: Data Package
-   Status
-   Learning
-   Next steps
-   Gaps
-   What has worked? What hasn't?
-   Plots exploring the statistics
-   Recommendations

```{r}
#| child: "Reproducing JMP estimates(SDG 6).qmd"

```


```{r}
#Plotting R squared

jmprsquared %>% 
    ggplot(aes(x = var_long, y = rsq)) + geom_boxplot(fill = "pink") + facet_wrap(~residence)
    
    


```
```{r}
jmprsquared %>% 
    filter(var_long %in% c("Sewer", "Shared") & rsq < 0.30)
```

## Plotting coverage for countries with a low rsquared for var_long equal to sewer/shared

```{r}


jmp_all_mean_value %>% 
    filter(var_long %in% c("Sewer") & iso3 == "AFG") %>%
    ggplot(aes(x = year, y = mean_value)) + geom_point() + facet_wrap(~residence) +geom_smooth(method = "lm", se = FALSE)
    


```
# Model performance
## Fitting different models to the data to compare performance

```{r}
# Fitting a polynomial of order 4


poly4model <- jmp_all_mean_value %>% 
    filter(var_long %in% c("Sewer", "Shared")) %>% 
    nest_by(iso3, residence, var_long) %>% 
    mutate(model = list(lm(mean_value ~ poly(year,4, raw = TRUE), data = data)))


rsquared <- poly4model|> 
    summarise(rsq = summary(model)$r.squared) 


  
```


```{r}
#Splines

library(splines)

splinemodel <- jmp_all_mean_value %>% 
    filter(var_long %in% c("Sewer", "Shared")) %>% 
    nest_by(iso3, residence, var_long) %>% 
    mutate(model = list(lm(mean_value ~ bs(year, knots = quantile(jmp_all_mean_value$year, p = c(0.25,0.5,0.75))), data = data)))


rsquared <- splinemodel|> 
    summarise(rsq = summary(model)$r.squared) 

```

```{r}
# Generalized Additive Model

library(mgcv)

GAMmodel <- jmp_all_mean_value %>% 
    filter(var_long %in% c("Sewer", "Shared")) %>% 
    mutate(model = list(gam(mean_value ~ s(year) , data = .)))


    


```


# Plots
## Plot using a 4th order polynomial

```{r}
jmp_all_mean_value %>% 
    filter(var_long %in% c("Sewer") & iso3 == "AFG") %>%
    ggplot(aes(x = year, y = mean_value)) + geom_point() + facet_wrap(~residence) +
    stat_smooth(method = "lm", formula =  y ~ poly(x,4, raw = TRUE))
```
## Plot using splines

```{r}
jmp_all_mean_value %>% 
    filter(var_long %in% c("Sewer") & iso3 == "AFG") %>%
    ggplot(aes(x = year, y = mean_value)) + geom_point() + facet_wrap(~residence) +
    stat_smooth(method = "lm", formula =  y ~ splines::bs(x, df = 3))
```
## Plot using GAM

```{r}
jmp_all_mean_value %>% 
    filter(var_long %in% c("Sewer") & iso3 == "AFG") %>%
    ggplot(aes(x = year, y = mean_value)) + geom_point() + facet_wrap(~residence) +
    stat_smooth(method = gam, formula =  y ~ s(x, k=3))
```


